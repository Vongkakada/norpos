{"ast":null,"code":"var _jsxFileName = \"D:\\\\CUS\\\\POS Nor Coffee\\\\pos\\\\src\\\\components\\\\Receipt\\\\ReceiptModal.js\",\n  _s = $RefreshSig$();\n// src/components/Receipt/ReceiptModal.js\nimport React, { useContext, useRef, useEffect } from 'react';\nimport { useReactToPrint } from 'react-to-print';\nimport { OrderContext } from '../../contexts/OrderContext';\nimport ReceiptContent from './ReceiptContent';\n// import '../../assets/styles/Receipt.css'; // Styles imported globally or by App.js\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ReceiptModal = ({\n  isOpen,\n  onClose\n}) => {\n  _s();\n  const {\n    currentOrder,\n    generateOrderId,\n    prepareForNewOrder\n  } = useContext(OrderContext);\n\n  // Capture a snapshot of currentOrder and orderId when modal opens\n  // This prevents the receipt from changing if the main order is cleared too soon\n  const [receiptData, setReceiptData] = React.useState(null);\n  useEffect(() => {\n    if (isOpen) {\n      setReceiptData({\n        orderItems: [...currentOrder],\n        // Create a deep copy\n        orderId: generateOrderId()\n      });\n    }\n  }, [isOpen, currentOrder, generateOrderId]);\n  const componentRef = useRef(); // Ref for the printable content\n\n  const handlePrint = useReactToPrint({\n    content: () => componentRef.current,\n    documentTitle: `Receipt-Order-${(receiptData === null || receiptData === void 0 ? void 0 : receiptData.orderId) || 'current'}`,\n    onAfterPrint: () => {\n      console.log('Printed successfully or print dialog closed.');\n      // It's better to prepare for new order AFTER print dialog is closed,\n      // not just when the modal is closed.\n    }\n  });\n  const handleCloseModal = () => {\n    prepareForNewOrder(); // Clear current order and increment order counter\n    onClose(); // Call the onClose passed from App.js\n  };\n  if (!isOpen || !receiptData) {\n    return null; // Don't render if not open or no data\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"receipt-modal-overlay\",\n    onClick: e => {\n      if (e.target === e.currentTarget) handleCloseModal();\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"receipt-modal-content\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"receipt-modal-close-button\",\n        onClick: handleCloseModal,\n        \"aria-label\": \"\\u1794\\u17B7\\u1791\\u179C\\u17B7\\u1780\\u17D2\\u1780\\u1799\\u1794\\u178F\\u17D2\\u179A\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"receipt-scrollable-area\",\n        children: /*#__PURE__*/_jsxDEV(ReceiptContent, {\n          ref: componentRef,\n          orderForReceipt: receiptData.orderItems,\n          orderIdForReceipt: receiptData.orderId\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"receipt-modal-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-print-receipt\",\n          onClick: handlePrint,\n          disabled: !receiptData.orderItems || receiptData.orderItems.length === 0,\n          children: \"\\u1794\\u17C4\\u17C7\\u1796\\u17BB\\u1798\\u17D2\\u1796\\u179C\\u17B7\\u1780\\u17D2\\u1780\\u1799\\u1794\\u178F\\u17D2\\u179A\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 47,\n    columnNumber: 9\n  }, this);\n};\n_s(ReceiptModal, \"b4XKlTo8i1et06rWE/rag05ou3U=\", false, function () {\n  return [useReactToPrint];\n});\n_c = ReceiptModal;\nexport default ReceiptModal;\nvar _c;\n$RefreshReg$(_c, \"ReceiptModal\");","map":{"version":3,"names":["React","useContext","useRef","useEffect","useReactToPrint","OrderContext","ReceiptContent","jsxDEV","_jsxDEV","ReceiptModal","isOpen","onClose","_s","currentOrder","generateOrderId","prepareForNewOrder","receiptData","setReceiptData","useState","orderItems","orderId","componentRef","handlePrint","content","current","documentTitle","onAfterPrint","console","log","handleCloseModal","className","onClick","e","target","currentTarget","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","orderForReceipt","orderIdForReceipt","disabled","length","_c","$RefreshReg$"],"sources":["D:/CUS/POS Nor Coffee/pos/src/components/Receipt/ReceiptModal.js"],"sourcesContent":["// src/components/Receipt/ReceiptModal.js\r\nimport React, { useContext, useRef, useEffect } from 'react';\r\nimport { useReactToPrint } from 'react-to-print';\r\nimport { OrderContext } from '../../contexts/OrderContext';\r\nimport ReceiptContent from './ReceiptContent';\r\n// import '../../assets/styles/Receipt.css'; // Styles imported globally or by App.js\r\n\r\nconst ReceiptModal = ({ isOpen, onClose }) => {\r\n    const { currentOrder, generateOrderId, prepareForNewOrder } = useContext(OrderContext);\r\n    \r\n    // Capture a snapshot of currentOrder and orderId when modal opens\r\n    // This prevents the receipt from changing if the main order is cleared too soon\r\n    const [receiptData, setReceiptData] = React.useState(null);\r\n    \r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            setReceiptData({\r\n                orderItems: [...currentOrder], // Create a deep copy\r\n                orderId: generateOrderId()\r\n            });\r\n        }\r\n    }, [isOpen, currentOrder, generateOrderId]);\r\n\r\n\r\n    const componentRef = useRef(); // Ref for the printable content\r\n\r\n    const handlePrint = useReactToPrint({\r\n        content: () => componentRef.current,\r\n        documentTitle: `Receipt-Order-${receiptData?.orderId || 'current'}`,\r\n        onAfterPrint: () => {\r\n            console.log('Printed successfully or print dialog closed.');\r\n            // It's better to prepare for new order AFTER print dialog is closed,\r\n            // not just when the modal is closed.\r\n        }\r\n    });\r\n\r\n    const handleCloseModal = () => {\r\n        prepareForNewOrder(); // Clear current order and increment order counter\r\n        onClose(); // Call the onClose passed from App.js\r\n    };\r\n\r\n    if (!isOpen || !receiptData) {\r\n        return null; // Don't render if not open or no data\r\n    }\r\n\r\n    return (\r\n        <div className=\"receipt-modal-overlay\" onClick={(e) => { if (e.target === e.currentTarget) handleCloseModal();}}>\r\n            <div className=\"receipt-modal-content\">\r\n                <button \r\n                    className=\"receipt-modal-close-button\" \r\n                    onClick={handleCloseModal}\r\n                    aria-label=\"បិទវិក្កយបត្រ\"\r\n                >\r\n                    ×\r\n                </button>\r\n                \r\n                <div className=\"receipt-scrollable-area\">\r\n                    {/* Pass the snapshot of data to ReceiptContent */}\r\n                    <ReceiptContent \r\n                        ref={componentRef} \r\n                        orderForReceipt={receiptData.orderItems}\r\n                        orderIdForReceipt={receiptData.orderId}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"receipt-modal-actions\">\r\n                    {/* Optional: A separate close button if needed */}\r\n                    {/* <button className=\"btn-close-receipt\" onClick={handleCloseModal}>បិទ</button> */}\r\n                    <button className=\"btn-print-receipt\" onClick={handlePrint} disabled={!receiptData.orderItems || receiptData.orderItems.length === 0}>\r\n                        បោះពុម្ពវិក្កយបត្រ\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ReceiptModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}