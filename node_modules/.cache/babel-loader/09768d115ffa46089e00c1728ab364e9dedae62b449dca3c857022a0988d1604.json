{"ast":null,"code":"var _jsxFileName = \"D:\\\\CUS\\\\POS Nor Coffee\\\\pos\\\\src\\\\contexts\\\\OrderContext.js\",\n  _s = $RefreshSig$();\n// src/contexts/OrderContext.js\n// ... (imports and existing code) ...\nimport React, { createContext, useState, useCallback, useMemo } from 'react';\nimport { submitOrder as apiSubmitOrder } from '../services/api'; // Import the API call\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const OrderProvider = ({\n  children\n}) => {\n  _s();\n  // ... (existing states: currentOrder, orderCounter, constants) ...\n  const [isSubmittingOrder, setIsSubmittingOrder] = useState(false);\n  const [submissionError, setSubmissionError] = useState(null);\n\n  // ... (existing functions: addItemToOrder, updateItemQuantity, clearOrder, totals, generateOrderId) ...\n\n  const processAndSubmitOrder = useCallback(async paymentMethod => {\n    if (currentOrder.length === 0) {\n      setSubmissionError(\"មិនមានទំនិញក្នុងបញ្ជីបញ្ជាទិញទេ។\");\n      return null; // Indicate failure or no action\n    }\n    setIsSubmittingOrder(true);\n    setSubmissionError(null);\n    const orderPayload = {\n      items: currentOrder.map(item => ({\n        menuItemId: item.id,\n        // IMPORTANT: Assume item object from API has 'id'\n        quantity: item.quantity,\n        priceAtOrderUSD: item.priceUSD,\n        // Price at the time of order\n        priceAtOrderKHR: item.priceKHR // Price at the time of order\n      })),\n      paymentMethod: paymentMethod || \"មិនបានបញ្ជាក់\" // Default payment method\n      // Backend should calculate orderNumber, totals, tax, orderDate\n    };\n    try {\n      const submittedOrder = await apiSubmitOrder(orderPayload);\n      console.log(\"Order submitted successfully:\", submittedOrder);\n      // prepareForNewOrder(); // This will be called by ReceiptModal after it's closed\n      setIsSubmittingOrder(false);\n      return submittedOrder; // Return the response from backend (e.g., { orderId, orderNumber, ... })\n    } catch (error) {\n      console.error(\"Failed to submit order:\", error);\n      setSubmissionError(error.message || \"ការបញ្ជូនការបញ្ជាទិញបានបរាជ័យ។\");\n      setIsSubmittingOrder(false);\n      throw error; // Re-throw for the calling component to handle\n    }\n  }, [currentOrder]); // Removed prepareForNewOrder from dependencies here\n\n  const prepareForNewOrder = useCallback(() => {\n    clearOrder();\n    setOrderCounter(prev => prev + 1);\n    setSubmissionError(null); // Clear any previous submission errors\n  }, [clearOrder]);\n  const value = {\n    // ... (all existing values) ...\n    processAndSubmitOrder,\n    isSubmittingOrder,\n    submissionError,\n    prepareForNewOrder // Ensure this is still exported\n  };\n  return /*#__PURE__*/_jsxDEV(OrderContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 12\n  }, this);\n};\n_s(OrderProvider, \"1vkZGCCuGlWHBsO1pXRWut0To6s=\");\n_c = OrderProvider;\nvar _c;\n$RefreshReg$(_c, \"OrderProvider\");","map":{"version":3,"names":["React","createContext","useState","useCallback","useMemo","submitOrder","apiSubmitOrder","jsxDEV","_jsxDEV","OrderProvider","children","_s","isSubmittingOrder","setIsSubmittingOrder","submissionError","setSubmissionError","processAndSubmitOrder","paymentMethod","currentOrder","length","orderPayload","items","map","item","menuItemId","id","quantity","priceAtOrderUSD","priceUSD","priceAtOrderKHR","priceKHR","submittedOrder","console","log","error","message","prepareForNewOrder","clearOrder","setOrderCounter","prev","value","OrderContext","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/CUS/POS Nor Coffee/pos/src/contexts/OrderContext.js"],"sourcesContent":["// src/contexts/OrderContext.js\r\n// ... (imports and existing code) ...\r\nimport React, { createContext, useState, useCallback, useMemo } from 'react';\r\nimport { submitOrder as apiSubmitOrder } from '../services/api'; // Import the API call\r\n\r\nexport const OrderProvider = ({ children }) => {\r\n    // ... (existing states: currentOrder, orderCounter, constants) ...\r\n    const [isSubmittingOrder, setIsSubmittingOrder] = useState(false);\r\n    const [submissionError, setSubmissionError] = useState(null);\r\n\r\n\r\n    // ... (existing functions: addItemToOrder, updateItemQuantity, clearOrder, totals, generateOrderId) ...\r\n\r\n    const processAndSubmitOrder = useCallback(async (paymentMethod) => {\r\n        if (currentOrder.length === 0) {\r\n            setSubmissionError(\"មិនមានទំនិញក្នុងបញ្ជីបញ្ជាទិញទេ។\");\r\n            return null; // Indicate failure or no action\r\n        }\r\n\r\n        setIsSubmittingOrder(true);\r\n        setSubmissionError(null);\r\n\r\n        const orderPayload = {\r\n            items: currentOrder.map(item => ({\r\n                menuItemId: item.id, // IMPORTANT: Assume item object from API has 'id'\r\n                quantity: item.quantity,\r\n                priceAtOrderUSD: item.priceUSD, // Price at the time of order\r\n                priceAtOrderKHR: item.priceKHR, // Price at the time of order\r\n            })),\r\n            paymentMethod: paymentMethod || \"មិនបានបញ្ជាក់\", // Default payment method\r\n            // Backend should calculate orderNumber, totals, tax, orderDate\r\n        };\r\n\r\n        try {\r\n            const submittedOrder = await apiSubmitOrder(orderPayload);\r\n            console.log(\"Order submitted successfully:\", submittedOrder);\r\n            // prepareForNewOrder(); // This will be called by ReceiptModal after it's closed\r\n            setIsSubmittingOrder(false);\r\n            return submittedOrder; // Return the response from backend (e.g., { orderId, orderNumber, ... })\r\n        } catch (error) {\r\n            console.error(\"Failed to submit order:\", error);\r\n            setSubmissionError(error.message || \"ការបញ្ជូនការបញ្ជាទិញបានបរាជ័យ។\");\r\n            setIsSubmittingOrder(false);\r\n            throw error; // Re-throw for the calling component to handle\r\n        }\r\n    }, [currentOrder]); // Removed prepareForNewOrder from dependencies here\r\n\r\n    const prepareForNewOrder = useCallback(() => {\r\n        clearOrder();\r\n        setOrderCounter(prev => prev + 1);\r\n        setSubmissionError(null); // Clear any previous submission errors\r\n    }, [clearOrder]);\r\n\r\n\r\n    const value = {\r\n        // ... (all existing values) ...\r\n        processAndSubmitOrder,\r\n        isSubmittingOrder,\r\n        submissionError,\r\n        prepareForNewOrder // Ensure this is still exported\r\n    };\r\n\r\n    return <OrderContext.Provider value={value}>{children}</OrderContext.Provider>;\r\n};"],"mappings":";;AAAA;AACA;AACA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,OAAO,QAAQ,OAAO;AAC5E,SAASC,WAAW,IAAIC,cAAc,QAAQ,iBAAiB,CAAC,CAAC;AAAA,SAAAC,MAAA,IAAAC,OAAA;AAEjE,OAAO,MAAMC,aAAa,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC3C;EACA,MAAM,CAACC,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EACjE,MAAM,CAACY,eAAe,EAAEC,kBAAkB,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;;EAG5D;;EAEA,MAAMc,qBAAqB,GAAGb,WAAW,CAAC,MAAOc,aAAa,IAAK;IAC/D,IAAIC,YAAY,CAACC,MAAM,KAAK,CAAC,EAAE;MAC3BJ,kBAAkB,CAAC,kCAAkC,CAAC;MACtD,OAAO,IAAI,CAAC,CAAC;IACjB;IAEAF,oBAAoB,CAAC,IAAI,CAAC;IAC1BE,kBAAkB,CAAC,IAAI,CAAC;IAExB,MAAMK,YAAY,GAAG;MACjBC,KAAK,EAAEH,YAAY,CAACI,GAAG,CAACC,IAAI,KAAK;QAC7BC,UAAU,EAAED,IAAI,CAACE,EAAE;QAAE;QACrBC,QAAQ,EAAEH,IAAI,CAACG,QAAQ;QACvBC,eAAe,EAAEJ,IAAI,CAACK,QAAQ;QAAE;QAChCC,eAAe,EAAEN,IAAI,CAACO,QAAQ,CAAE;MACpC,CAAC,CAAC,CAAC;MACHb,aAAa,EAAEA,aAAa,IAAI,eAAe,CAAE;MACjD;IACJ,CAAC;IAED,IAAI;MACA,MAAMc,cAAc,GAAG,MAAMzB,cAAc,CAACc,YAAY,CAAC;MACzDY,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEF,cAAc,CAAC;MAC5D;MACAlB,oBAAoB,CAAC,KAAK,CAAC;MAC3B,OAAOkB,cAAc,CAAC,CAAC;IAC3B,CAAC,CAAC,OAAOG,KAAK,EAAE;MACZF,OAAO,CAACE,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC/CnB,kBAAkB,CAACmB,KAAK,CAACC,OAAO,IAAI,gCAAgC,CAAC;MACrEtB,oBAAoB,CAAC,KAAK,CAAC;MAC3B,MAAMqB,KAAK,CAAC,CAAC;IACjB;EACJ,CAAC,EAAE,CAAChB,YAAY,CAAC,CAAC,CAAC,CAAC;;EAEpB,MAAMkB,kBAAkB,GAAGjC,WAAW,CAAC,MAAM;IACzCkC,UAAU,CAAC,CAAC;IACZC,eAAe,CAACC,IAAI,IAAIA,IAAI,GAAG,CAAC,CAAC;IACjCxB,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC;EAC9B,CAAC,EAAE,CAACsB,UAAU,CAAC,CAAC;EAGhB,MAAMG,KAAK,GAAG;IACV;IACAxB,qBAAqB;IACrBJ,iBAAiB;IACjBE,eAAe;IACfsB,kBAAkB,CAAC;EACvB,CAAC;EAED,oBAAO5B,OAAA,CAACiC,YAAY,CAACC,QAAQ;IAACF,KAAK,EAAEA,KAAM;IAAA9B,QAAA,EAAEA;EAAQ;IAAAiC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAwB,CAAC;AAClF,CAAC;AAACnC,EAAA,CA1DWF,aAAa;AAAAsC,EAAA,GAAbtC,aAAa;AAAA,IAAAsC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}